## 构建工具

### 不使用任何构建工具，也不使用`babel`等做编译处理

## `TypeScript`支持

### 配置`TypeScript`开发环境

#### 安装、生成配置文件和配置具体的配置文件

#### 安装开发环境实时编译工具`ts-node-dev`

```bash
yarn add ts-node-dev --dev
```

`package.json`配置`scripts`

```json
"dev": "ts-node-dev --respawn --transpile-only src/index.ts",
```

#### 配置文件开发严格模式——any类型会报错提示

发现你的ts工程到处使用`any`类型都不会有错误提示，但是你的`@typescript-eslint`并没有关闭错误提示规则，默认它就是开启的，然后即使手动开启了，也没有生效，那么问题就不在`eslint`配置上，而在`tsconfig`配置上，那么你就要换个方向，`tsconfig`有一个`strict`的编译`compilerOptions`配置选项，默认不是开启的，所以如果不手动设置为`true`的话，默认就不会对`any`类型进行错误提示，即使`eslint`里面已经开启了，但是它最终还是要走一遍`tsconfig`配置。

##### `"strict": true,`

```
"strict": true,
```



###  兼容ts的代码语法质量和格式统一的自动环境搭建

#### `eslint` + `prettier`

#### 参考

https://zhuanlan.zhihu.com/p/432906440

#### `eslint`

##### 依赖

```shell
pnpm install eslint eslint-plugin-import eslint-config-airbnb-base -D
```

##### 增加`typescript`依赖

```shell
pnpm install typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser -D
```

tslint已经不维护了，不要使用别的，就用`@typescript-eslint/eslint-plugin`就对了，官方推荐！作用当然是针对ts制定了一系列的eslint规则。

@typescript-eslint/parser的作用是用来解析ts语句。eslint本身不支持ts语法。

##### 注意两个用于`Eslint`解析ts语法的依赖项对nodejs版本的要求

```json
 "engines": {
    "node": "^18.18.0 || >=20.0.0"
  },
```

##### `eslint`配置文件注意，指定解析`ts`代码的解析选项`parserOptions`需要指定根目录路径，否则报错找不到xxxx

```js
module.exports = {
  extends: [
    "eslint-config-airbnb-base",
    "plugin:@typescript-eslint/recommended",
  ],
  parser: "@typescript-eslint/parser",
  plugins: ["@typescript-eslint"],
  rules: {
    "import/extensions": "off",
    "no-use-before-define": "off",
    "@typescript-eslint/no-use-before-define": [
      "error",
      { ignoreTypeReferences: true },
    ],
    "import/prefer-default-export": "off",
  },
  settings: {
    "import/resolver": {
      node: {
        extensions: [".js", ".ts"],
        moduleDirectory: ["node_modules", "./src"],
      },
    },
  },
  parserOptions: {
    project: "./tsconfig.json",
    tsconfigRootDir: __dirname,
  },
};

```



#### `prettier`以及`eslint prettier`两者冲突解决

##### 安装依赖

```shell
pnpm install prettier eslint-plugin-prettier eslint-config-prettier -D
```

prettier作为peer-dependencies引入。eslint-config-prettier用来关闭所有和prettier冲突的eslint规则（prettier的规则时没有办法关闭的，很霸道！）。eslint-plugin-prettier告诉eslint应该怎么按照prettier的方式去格式化文档。

##### **新增.prettierrc文件**

```json
{
  "semi": false,
  "tabWidth": 2,
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 140
}
```

此时如果`vscode`配置了保存代码自动使用`prettier`格式和代码，那么优先级是按照上面的配置进行格式化代码，此时如果配置与`eslint`的规则是冲突的，**自然保存的代码默认会展示`eslnt`显示的红色错误，所以需要再进行`eslint`配置，配置格式化代码规则优先采用`eslint`的规则，这样保存后代码格式就不会报错，而如果不符合`prettier`的格式，那么eslint就会显示红色错误**

##### **修改.eslintrc.js**

- 关键位置如下

  ```js
  extends: ['eslint-config-airbnb-base', 'plugin:@typescript-eslint/recommended', 'plugin:prettier/recommended'],
  rules: {
      'prettier/prettier': [
        'error',
        {
          endOfLine: 'auto',
        },
      ],
    },    
  ```

  保证`plugin:prettier/recommended`在数组的最后面

  增加`rules`配置`prettier/prettier`选项是设置语法规则不符合`prettier`配置的时候如何报错，这里面我们设置`prettier` 的`endOfLine`是因为

  > `endOfLine` 选项用于指定在代码中的换行符。它有以下选项：
  >
  > - `auto`: 自动检测并转换换行符。这是默认选项。
  > - `lf`: 将换行符转换为 LF (Unix) 格式。
  > - `crlf`: 将换行符转换为 CRLF (Windows) 格式。
  > - `cr`: 将换行符转换为 CR (Mac) 格式。
  >
  > 如果我们当前保存代码的换行符格式不符合，那么整个代码会显示红色错误：`[eslint] Delete `CR` [prettier/prettier]`，这里我们配置为`auto`来自动修复。

### 源码从`js`迁移到`ts`

####  配合`eslint` + `tsconfig`对any类型和其他类型问题进行纠错来将源码从`js`迁移为`ts`

#### 少部分位置可以借助注释，来暂时忽略一些改起来麻烦，同时不太重要的地方报错



### 编译打包

#### 关于模块化语法问题

##### 开发推荐使用`esmodule`语法导入导出

> 使用`typescript`开发的时候，建议使用`esmodule`的模块语法，而不是使用`commonjs`模块语法，即使你开发的项目最终打包后的生产环境的代码是用于`nodejs`环境，涉及配置项如下
>
> 在 TypeScript 中，建议使用 `import` 语句来导入模块，因为它提供了更好的类型检查和更强大的功能。使用 `require` 语句可能会导致类型错误和运行时错误。如果你确实需要使用 CommonJS 模块，你可以在 `tsconfig.json` 文件中设置 `"module": "CommonJS"`，然后使用 `import` 语句来导入模块。
>
> `eslint@typescript-eslint/no-var-requires` 规则是建议使用 ES6 模块（也称为 ES 模块）的 `import` 语法来导入模块，而不是 CommonJS 的 `require` 语法。使用 `import` 语法可以提供更好的类型检查和更强大的功能，例如支持静态分析、树摇（tree shaking）等。
>
> ```json
>  "module": "CommonJS",
> ```

##### `typescript`编译器支持构建满足`ESModule`和`CommonJs`模块语法的产物

涉及如下配置即可，具体查阅官方文档https://www.typescriptlang.org/tsconfig#module

```json
{
  "compilerOptions": {
    "module": "CommonJS",
    "esModuleInterop": true,
    "target": "ES6"
  }
}
```



#### 涉及`tsc`编译选项

#### dist目录

​		

